# GitHub Action Errors

- Date: 2025-10-25
- Run Log: https://github.com/Dreffed/aetherlens/actions/runs/18809256164/job/53667974316

## Lint Code

- *Run ruff*

```
Found 118 errors.
[*] 92 fixable with the `--fix` option (6 hidden fixes can be enabled with the `--unsafe-fixes` option).
Error: Process completed with exit code 1.
```

## Unit Tests (3.11)

- *Check Coverage Threshold*

```
Run COVERAGE=$(python -c "import xml.etree.ElementTree as ET; tree = ET.parse('coverage.xml'); root = tree.getroot(); print(root.attrib['line-rate'])")
Coverage: 47.4600%
âŒ Coverage 47.4600% is below 70% threshold
Error: Process completed with exit code 1.
```

## Integration Tests (3.12)

- *Run integration tests with coverage*

```
...

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform linux, python 3.12.11-final-0 ----------
Name                                    Stmts   Miss   Cover   Missing
----------------------------------------------------------------------
src/aetherlens/__init__.py                  3      0 100.00%
src/aetherlens/api/__init__.py              0      0 100.00%
src/aetherlens/api/database.py             26     12  53.85%   22-32, 36-42, 48
src/aetherlens/api/dependencies.py         27     15  44.44%   39-64, 80-87
src/aetherlens/api/logging.py              22      0 100.00%
src/aetherlens/api/main.py                 44      9  79.55%   33-44, 109, 116
src/aetherlens/api/metrics.py              39     11  71.79%   55, 91-103
src/aetherlens/api/rate_limit.py           44      5  88.64%   56, 98-103, 113-118
src/aetherlens/api/routes/__init__.py       0      0 100.00%
src/aetherlens/api/routes/auth.py          33     13  60.61%   52-92
src/aetherlens/api/routes/devices.py       72     54  25.00%   41-74, 97-116, 135-166, 190-228, 246-259
src/aetherlens/api/routes/health.py        57     13  77.19%   32-39, 59-71, 140-143
src/aetherlens/collection/__init__.py       0      0 100.00%
src/aetherlens/config.py                   25      0 100.00%
src/aetherlens/costs/__init__.py            0      0 100.00%
src/aetherlens/models/__init__.py           0      0 100.00%
src/aetherlens/models/device.py            45      3  93.33%   29-31
src/aetherlens/models/metric.py            32     32   0.00%   4-49
src/aetherlens/plugins/__init__.py          0      0 100.00%
src/aetherlens/security/__init__.py         0      0 100.00%
src/aetherlens/security/jwt.py             36     11  69.44%   38, 62-80, 101, 112-113
src/aetherlens/security/passwords.py        7      4  42.86%   17-19, 33
----------------------------------------------------------------------
TOTAL                                     512    182  64.45%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml

...

============ 14 failed, 10 passed, 36 warnings, 57 errors in 16.66s ============
Error: Process completed with exit code 1.
```

## Security Tests (3.11)

- *Security Tests (3.11)*

```
Run pytest tests/security/ -v -m security
  pytest tests/security/ -v -m security
  shell: /usr/bin/bash -e {0}
  env:
    pythonLocation: /opt/hostedtoolcache/Python/3.11.13/x64
    PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib/pkgconfig
    Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
    Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
    Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
    LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib
    SECRET_KEY: test_secret_key_minimum_32_characters_long_for_ci_only_testing
    PYTHONPATH: /home/runner/work/aetherlens/aetherlens/src
============================= test session starts ==============================
platform linux -- Python 3.11.13, pytest-7.4.4, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
cachedir: .pytest_cache
rootdir: /home/runner/work/aetherlens/aetherlens
configfile: pyproject.toml
plugins: anyio-4.11.0, asyncio-0.23.8, timeout-2.4.0, cov-5.0.0, mock-3.15.1
asyncio: mode=Mode.AUTO
collecting ... collected 3 items

tests/security/test_security_scans.py::test_secure_password_hashing PASSED [ 33%]
tests/security/test_security_scans.py::test_jwt_secret_key_strength FAILED [ 66%]
tests/security/test_security_scans.py::test_no_hardcoded_secrets PASSED  [100%]

=================================== FAILURES ===================================
_________________________ test_jwt_secret_key_strength _________________________

    @pytest.mark.security
    def test_jwt_secret_key_strength():
        """Verify JWT secret key meets minimum security requirements."""
        from aetherlens.config import settings

        secret_key = settings.secret_key

        # Minimum length
        assert len(secret_key) >= 32, "JWT secret key too short (minimum 32 characters)"

        # Should not be weak/default
        weak_keys = ["secret", "changeme", "password"]
>       assert not any(weak in secret_key.lower() for weak in weak_keys[:3]), \
            "JWT secret key appears to be weak/default"
E       AssertionError: JWT secret key appears to be weak/default
E       assert not True
E        +  where True = any(<generator object test_jwt_secret_key_strength.<locals>.<genexpr> at 0x7f0d2d086dc0>)

tests/security/test_security_scans.py:39: AssertionError
=============================== warnings summary ===============================
../../../../../opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/starlette/formparsers.py:12
  /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/starlette/formparsers.py:12: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

src/aetherlens/models/device.py:45
  /home/runner/work/aetherlens/aetherlens/src/aetherlens/models/device.py:45: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DeviceResponse(DeviceBase):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform linux, python 3.11.13-final-0 ----------
Name                                    Stmts   Miss   Cover   Missing
----------------------------------------------------------------------
src/aetherlens/__init__.py                  3      0 100.00%
src/aetherlens/api/__init__.py              0      0 100.00%
src/aetherlens/api/database.py             26     14  46.15%   22-32, 36-42, 46-48
src/aetherlens/api/dependencies.py         27     17  37.04%   33-64, 80-87
src/aetherlens/api/logging.py              22      9  59.09%   53-78
src/aetherlens/api/main.py                 44     11  75.00%   33-44, 88-89, 109, 116
src/aetherlens/api/metrics.py              39     23  41.03%   54-81, 91-103
src/aetherlens/api/rate_limit.py           44     30  31.82%   21, 40-56, 68-71, 77-136
src/aetherlens/api/routes/__init__.py       0      0 100.00%
src/aetherlens/api/routes/auth.py          33     14  57.58%   51-92
src/aetherlens/api/routes/devices.py       72     54  25.00%   41-74, 97-116, 135-166, 190-228, 246-259
src/aetherlens/api/routes/health.py        57     34  40.35%   30-47, 56-78, 99-124, 138-147, 161
src/aetherlens/collection/__init__.py       0      0 100.00%
src/aetherlens/config.py                   25      0 100.00%
src/aetherlens/costs/__init__.py            0      0 100.00%
src/aetherlens/models/__init__.py           0      0 100.00%
src/aetherlens/models/device.py            45      3  93.33%   29-31
src/aetherlens/models/metric.py            32     32   0.00%   4-49
src/aetherlens/plugins/__init__.py          0      0 100.00%
src/aetherlens/security/__init__.py         0      0 100.00%
src/aetherlens/security/jwt.py             36     24  33.33%   35-54, 62-80, 95-113
src/aetherlens/security/passwords.py        7      0 100.00%
----------------------------------------------------------------------
TOTAL                                     512    265  48.24%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml

=========================== short test summary info ============================
FAILED tests/security/test_security_scans.py::test_jwt_secret_key_strength - AssertionError: JWT secret key appears to be weak/default
assert not True
 +  where True = any(<generator object test_jwt_secret_key_strength.<locals>.<genexpr> at 0x7f0d2d086dc0>)
=================== 1 failed, 2 passed, 2 warnings in 1.19s ====================
Error: Process completed with exit code 1.
```

## Code Quality Tests (3.11)

- *Run quality tests*

```
Run pytest tests/quality/ -v -m quality
============================= test session starts ==============================
platform linux -- Python 3.11.13, pytest-7.4.4, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
cachedir: .pytest_cache
rootdir: /home/runner/work/aetherlens/aetherlens
configfile: pyproject.toml
plugins: anyio-4.11.0, asyncio-0.23.8, timeout-2.4.0, cov-5.0.0, mock-3.15.1
asyncio: mode=Mode.AUTO
collecting ... collected 0 items

=============================== warnings summary ===============================
../../../../../opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/starlette/formparsers.py:12
  /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/starlette/formparsers.py:12: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

src/aetherlens/models/device.py:45
  /home/runner/work/aetherlens/aetherlens/src/aetherlens/models/device.py:45: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DeviceResponse(DeviceBase):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform linux, python 3.11.13-final-0 ----------
Name                                    Stmts   Miss   Cover   Missing
----------------------------------------------------------------------
src/aetherlens/__init__.py                  3      0 100.00%
src/aetherlens/api/__init__.py              0      0 100.00%
src/aetherlens/api/database.py             26     14  46.15%   22-32, 36-42, 46-48
src/aetherlens/api/dependencies.py         27     17  37.04%   33-64, 80-87
src/aetherlens/api/logging.py              22      9  59.09%   53-78
src/aetherlens/api/main.py                 44     11  75.00%   33-44, 88-89, 109, 116
src/aetherlens/api/metrics.py              39     23  41.03%   54-81, 91-103
src/aetherlens/api/rate_limit.py           44     30  31.82%   21, 40-56, 68-71, 77-136
src/aetherlens/api/routes/__init__.py       0      0 100.00%
src/aetherlens/api/routes/auth.py          33     14  57.58%   51-92
src/aetherlens/api/routes/devices.py       72     54  25.00%   41-74, 97-116, 135-166, 190-228, 246-259
src/aetherlens/api/routes/health.py        57     34  40.35%   30-47, 56-78, 99-124, 138-147, 161
src/aetherlens/collection/__init__.py       0      0 100.00%
src/aetherlens/config.py                   25      0 100.00%
src/aetherlens/costs/__init__.py            0      0 100.00%
src/aetherlens/models/__init__.py           0      0 100.00%
src/aetherlens/models/device.py            45      3  93.33%   29-31
src/aetherlens/models/metric.py            32     32   0.00%   4-49
src/aetherlens/plugins/__init__.py          0      0 100.00%
src/aetherlens/security/__init__.py         0      0 100.00%
src/aetherlens/security/jwt.py             36     24  33.33%   35-54, 62-80, 95-113
src/aetherlens/security/passwords.py        7      4  42.86%   17-19, 33
----------------------------------------------------------------------
TOTAL                                     512    269  47.46%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml

============================= 2 warnings in 0.32s ==============================
Error: Process completed with exit code 5.
```

## Test Summary

- *Check test results*

```
0s
Run echo "## Test Results Summary" >> $GITHUB_STEP_SUMMARY
Error: Process completed with exit code 1.
```